{% extends "base.html" %}

{% block title %}–ë–∏–∑–Ω–µ—Å-–ø–∞–Ω–µ–ª—å - –°–∞–Ω—ã—á{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="animate-fade-in-down">
        <h2 class="mb-4">
            <i class="bi bi-graph-up text-primary-custom"></i> 
            –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–æ–º
        </h2>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-12 animate-fade-in-up animation-delay-200">
            <button class="btn btn-primary-custom btn-animated" data-bs-toggle="modal" data-bs-target="#addToiletModal">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç—É–∞–ª–µ—Ç
            </button>
        </div>
    </div>
    
    <!-- –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3 animate-fade-in-up animation-delay-300">
            <div class="card hover-lift">
                <div class="card-body text-center">
                    <i class="bi bi-cash-stack display-4 text-primary-custom"></i>
                    <h3 class="mt-3 mb-0" id="totalRevenue">0‚ÇΩ</h3>
                    <p class="text-muted">–û–±—â–∏–π –¥–æ—Ö–æ–¥</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3 animate-fade-in-up animation-delay-400">
            <div class="card hover-lift">
                <div class="card-body text-center">
                    <i class="bi bi-people-fill display-4 text-primary-custom"></i>
                    <h3 class="mt-3 mb-0" id="totalVisits">0</h3>
                    <p class="text-muted">–í—Å–µ–≥–æ –≤–∏–∑–∏—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3 animate-fade-in-up animation-delay-500">
            <div class="card hover-lift">
                <div class="card-body text-center">
                    <i class="bi bi-star-fill display-4 text-primary-custom"></i>
                    <h3 class="mt-3 mb-0" id="avgRating">0</h3>
                    <p class="text-muted">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3 animate-fade-in-up animation-delay-600">
            <div class="card hover-lift">
                <div class="card-body text-center">
                    <i class="bi bi-geo-alt-fill display-4 text-primary-custom"></i>
                    <h3 class="mt-3 mb-0" id="totalToilets">0</h3>
                    <p class="text-muted">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—á–µ–∫</p>
                </div>
            </div>
        </div>
    </div>
    
    <h3 class="mb-3">–í–∞—à–∏ —Ç—É–∞–ª–µ—Ç—ã</h3>
    <div class="row" id="statsContainer">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—é–¥–∞ -->
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—É–∞–ª–µ—Ç–∞ -->
<div class="modal fade" id="addToiletModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç—É–∞–ª–µ—Ç</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addToiletForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</label>
                                <input type="text" class="form-control form-control-custom" id="toiletName" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–ê–¥—Ä–µ—Å</label>
                                <input type="text" class="form-control form-control-custom" id="toiletAddress" required>
                                <small class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ</small>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                                <input type="number" class="form-control form-control-custom" id="toiletPrice" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã</label>
                                <input type="text" class="form-control form-control-custom" id="toiletHours" value="24/7">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea class="form-control form-control-custom" id="toiletDescription" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                                <div id="addToiletMap" style="width: 100%; height: 300px; border-radius: 8px; overflow: hidden;"></div>
                                <small class="text-muted mt-1 d-block">
                                    <i class="bi bi-info-circle"></i> –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤—ã—à–µ
                                </small>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-6">
                                    <input type="hidden" id="toiletLat" required>
                                    <small class="text-muted">–®–∏—Ä–æ—Ç–∞: <span id="latDisplay">-</span></small>
                                </div>
                                <div class="col-6">
                                    <input type="hidden" id="toiletLng" required>
                                    <small class="text-muted">–î–æ–ª–≥–æ—Ç–∞: <span id="lngDisplay">-</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-3">–£–¥–æ–±—Å—Ç–≤–∞</h6>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="toiletSoap" checked>
                                <label class="form-check-label" for="toiletSoap">
                                    üßº –ú—ã–ª–æ
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="toiletPaper" checked>
                                <label class="form-check-label" for="toiletPaper">
                                    üßª –¢—É–∞–ª–µ—Ç–Ω–∞—è –±—É–º–∞–≥–∞
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="toiletDryer">
                                <label class="form-check-label" for="toiletDryer">
                                    üí® –°—É—à–∏–ª–∫–∞ –¥–ª—è —Ä—É–∫
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="toiletMirror" checked>
                                <label class="form-check-label" for="toiletMirror">
                                    ü™û –ó–µ—Ä–∫–∞–ª–æ
                                </label>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="mb-3">–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h6>
                            <div class="form-check p-3 bg-light-custom rounded">
                                <input class="form-check-input" type="checkbox" id="toiletAccessible">
                                <label class="form-check-label" for="toiletAccessible">
                                    <i class="bi bi-universal-access-circle"></i> –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–æ–≤
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary-custom btn-animated" onclick="addToilet()">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç—É–∞–ª–µ—Ç
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç -->
<script src="https://api-maps.yandex.ru/2.1/?apikey=412fd96b-cac8-43fe-b2a6-b1ce8e91a1b2&lang=ru_RU" type="text/javascript"></script>

<script>
    let addToiletMap;
    let addToiletPlacemark;
    let searchControl;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    function initAddToiletMap() {
        if (addToiletMap) return; // –ö–∞—Ä—Ç–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
        
        ymaps.ready(function () {
            addToiletMap = new ymaps.Map("addToiletMap", {
                center: [43.5858, 39.7203], // –¶–µ–Ω—Ç—Ä –°–æ—á–∏
                zoom: 13,
                controls: ['zoomControl', 'typeSelector']
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É
            searchControl = new ymaps.control.SearchControl({
                options: {
                    provider: 'yandex#search',
                    float: 'left',
                    floatIndex: 100,
                    noPlacemark: true,
                    resultsPerPage: 5
                }
            });
            addToiletMap.controls.add(searchControl);

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
            addToiletMap.events.add('click', function (e) {
                const coords = e.get('coords');
                setToiletLocation(coords);
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞
            searchControl.events.add('resultselect', function (e) {
                const index = e.get('index');
                searchControl.getResult(index).then(function (result) {
                    const coords = result.geometry.getCoordinates();
                    setToiletLocation(coords);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞
                    const address = result.properties.get('text') || result.properties.get('name');
                    if (address && address !== 'undefined') {
                        document.getElementById('toiletAddress').value = address;
                    }
                });
            });
        });
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ç—É–∞–ª–µ—Ç–∞
    function setToiletLocation(coords) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –º–µ—Ç–∫—É
        if (addToiletPlacemark) {
            addToiletMap.geoObjects.remove(addToiletPlacemark);
        }

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
        addToiletPlacemark = new ymaps.Placemark(coords, {
            iconCaption: '–ù–æ–≤—ã–π —Ç—É–∞–ª–µ—Ç'
        }, {
            preset: 'islands#greenDotIcon',
            draggable: true // –ú–µ—Ç–∫—É –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –º–µ—Ç–∫–∏
        addToiletPlacemark.events.add('dragend', function () {
            const newCoords = addToiletPlacemark.geometry.getCoordinates();
            updateCoordinates(newCoords);
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–¥—Ä–µ—Å –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –º–µ—Ç–∫–∏
            getAddressFromCoords(newCoords);
        });

        addToiletMap.geoObjects.add(addToiletPlacemark);
        
        // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –º–µ—Ç–∫–µ
        addToiletMap.setCenter(coords, 16, {
            duration: 300
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        updateCoordinates(coords);
        
        // –ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –µ—Å–ª–∏ –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞ –ø—É—Å—Ç–æ–µ
        if (!document.getElementById('toiletAddress').value) {
            getAddressFromCoords(coords);
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
    function updateCoordinates(coords) {
        const lat = coords[0].toFixed(6);
        const lng = coords[1].toFixed(6);
        
        document.getElementById('toiletLat').value = lat;
        document.getElementById('toiletLng').value = lng;
        document.getElementById('latDisplay').textContent = lat;
        document.getElementById('lngDisplay').textContent = lng;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
    function getAddressFromCoords(coords) {
        ymaps.geocode(coords, {
            results: 1,
            kind: 'house'
        }).then(function (res) {
            const firstGeoObject = res.geoObjects.get(0);
            if (firstGeoObject) {
                const address = firstGeoObject.getAddressLine();
                if (address && address !== 'undefined') {
                    document.getElementById('toiletAddress').value = address;
                }
            }
        });
    }

    // –ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É –ø—Ä–∏ –≤–≤–æ–¥–µ
    let addressTimeout;
    $('#toiletAddress').on('input', function(e) {
        clearTimeout(addressTimeout);
        const address = e.target.value;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å "undefined"
        if (address === 'undefined') {
            e.target.value = '';
            return;
        }
        
        if (address.length > 3) {
            addressTimeout = setTimeout(() => {
                if (searchControl && address !== 'undefined') {
                    searchControl.search(address);
                }
            }, 500);
        }
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function loadStats() {
        showSkeletonStats();
        
        fetch('/api/business/stats')
            .then(response => response.json())
            .then(data => {
                let totalRevenue = 0;
                let totalVisits = 0;
                let totalRating = 0;
                let ratingCount = 0;
                
                const statsHtml = data.map((stat, index) => {
                    totalRevenue += stat.revenue_last_30_days;
                    totalVisits += stat.visits_last_30_days;
                    if (stat.rating > 0) {
                        totalRating += stat.rating;
                        ratingCount++;
                    }
                    
                    return `
                        <div class="col-md-6 mb-4 animate-fade-in-up animation-delay-${index * 100}">
                            <div class="card hover-lift card-animated">
                                <div class="card-body">
                                    <h5 class="card-title">${stat.name}</h5>
                                    <div class="row">
                                        <div class="col-6">
                                            <p class="mb-1 text-muted">–í–∏–∑–∏—Ç–æ–≤ –∑–∞ 30 –¥–Ω–µ–π</p>
                                            <h3 class="text-primary-custom">${stat.visits_last_30_days}</h3>
                                        </div>
                                        <div class="col-6">
                                            <p class="mb-1 text-muted">–î–æ—Ö–æ–¥ –∑–∞ 30 –¥–Ω–µ–π</p>
                                            <h3 class="text-success">${stat.revenue_last_30_days.toLocaleString('ru-RU')}‚ÇΩ</h3>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between">
                                        <span>
                                            <i class="bi bi-star-fill text-warning"></i> ${stat.rating}
                                        </span>
                                        <span class="text-muted">${stat.total_reviews} –æ—Ç–∑—ã–≤–æ–≤</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                $('#statsContainer').html(statsHtml || '<p class="text-muted">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç—É–∞–ª–µ—Ç–æ–≤</p>');
                
                animateValue('totalRevenue', totalRevenue, '‚ÇΩ');
                animateValue('totalVisits', totalVisits);
                animateValue('avgRating', ratingCount > 0 ? (totalRating / ratingCount).toFixed(1) : 0);
                animateValue('totalToilets', data.length);
            });
    }

    function showSkeletonStats() {
        const skeletonHtml = Array(2).fill('').map(() => `
            <div class="col-md-6 mb-4">
                <div class="card skeleton">
                    <div class="card-body">
                        <div class="skeleton-line" style="width: 60%; height: 24px; margin-bottom: 1rem;"></div>
                        <div class="row">
                            <div class="col-6">
                                <div class="skeleton-line" style="width: 80%; height: 16px; margin-bottom: 0.5rem;"></div>
                                <div class="skeleton-line" style="width: 50%; height: 32px;"></div>
                            </div>
                            <div class="col-6">
                                <div class="skeleton-line" style="width: 80%; height: 16px; margin-bottom: 0.5rem;"></div>
                                <div class="skeleton-line" style="width: 70%; height: 32px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        
        $('#statsContainer').html(skeletonHtml);
    }

    function animateValue(id, end, suffix = '') {
        const element = document.getElementById(id);
        const start = 0;
        const duration = 1000;
        const startTime = performance.now();
        
        function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = Math.floor(start + (end - start) * progress);
            element.textContent = current.toLocaleString('ru-RU') + suffix;
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        }
        
        requestAnimationFrame(update);
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—É–∞–ª–µ—Ç–∞
    function addToilet() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ
        if (!document.getElementById('toiletLat').value || !document.getElementById('toiletLng').value) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç—É–∞–ª–µ—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ');
            return;
        }
        
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> –î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
        button.disabled = true;
        
        const data = {
            name: $('#toiletName').val(),
            address: $('#toiletAddress').val(),
            latitude: parseFloat($('#toiletLat').val()),
            longitude: parseFloat($('#toiletLng').val()),
            price: parseFloat($('#toiletPrice').val()),
            is_accessible: $('#toiletAccessible').is(':checked'),
            working_hours: $('#toiletHours').val() || '24/7',
            description: $('#toiletDescription').val(),
            has_soap: $('#toiletSoap').is(':checked'),
            has_paper: $('#toiletPaper').is(':checked'),
            has_dryer: $('#toiletDryer').is(':checked'),
            has_mirror: $('#toiletMirror').is(':checked')
        };
        
        fetch('/api/business/toilets', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            button.classList.add('btn-success');
            button.innerHTML = '<i class="bi bi-check-circle"></i> –î–æ–±–∞–≤–ª–µ–Ω–æ!';
            
            setTimeout(() => {
                $('#addToiletModal').modal('hide');
                $('#addToiletForm')[0].reset();
                button.innerHTML = originalText;
                button.disabled = false;
                button.classList.remove('btn-success');
                
                // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É
                if (addToiletPlacemark) {
                    addToiletMap.geoObjects.remove(addToiletPlacemark);
                    addToiletPlacemark = null;
                }
                document.getElementById('latDisplay').textContent = '-';
                document.getElementById('lngDisplay').textContent = '-';
                
                loadStats();
            }, 1000);
        })
        .catch(error => {
            button.innerHTML = originalText;
            button.disabled = false;
            button.classList.add('btn-danger');
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç—É–∞–ª–µ—Ç–∞');
            setTimeout(() => button.classList.remove('btn-danger'), 2000);
        });
    }

    $(document).ready(function() {
        loadStats();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        $('#addToiletModal').on('shown.bs.modal', function () {
            initAddToiletMap();
        });
    });
</script>

<style>
    /* Skeleton loading animation */
    .skeleton {
        background: #f6f7f8;
        overflow: hidden;
        position: relative;
    }
    
    .skeleton::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
        animation: skeleton-loading 1.5s infinite;
    }
    
    @keyframes skeleton-loading {
        100% {
            transform: translateX(100%);
        }
    }
    
    .skeleton-line {
        background: #e0e0e0;
        border-radius: 4px;
        display: inline-block;
    }
    
    .form-control-custom {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 10px 15px;
        transition: all 0.3s ease;
    }
    
    .form-control-custom:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 0.2rem rgba(78, 205, 196, 0.25);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É—Å–ø–µ—Ö–∞ */
    .btn-success {
        background-color: #28a745 !important;
        border-color: #28a745 !important;
    }
    
    .btn-danger {
        background-color: #dc3545 !important;
        border-color: #dc3545 !important;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
    #addToiletMap {
        border: 2px solid #e0e0e0;
        transition: border-color 0.3s ease;
    }
    
    #addToiletMap:hover {
        border-color: var(--primary-green);
    }
    
    /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º z-index –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
    .modal .ymaps-2-1-79-controls__control {
        z-index: 1050 !important;
    }
    
    .modal .ymaps-2-1-79-searchbox {
        z-index: 1051 !important;
    }
</style>
{% endblock %}